<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolbox Cyber</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        form {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        h2 {
            margin-top: 0;
            color: #444;
        }
        input, button {
            padding: 8px;
            margin: 5px 0;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .status-indicator {
            display: flex;
            align-items: center;
            margin-top: 10px;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 4px;
        }
        .status-ok {
            background-color: #d4edda;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .status-warning {
            background-color: #fff3cd;
            color: #856404;
        }
        .status-connecting {
            background-color: #d1ecf1;
            color: #0c5460;
        }
        .status-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        .status-message {
            flex-grow: 1;
        }
        .status-refresh {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            font-size: 1.2em;
        }
        .templates-link {
            display: block;
            margin-top: 5px;
            font-size: 0.9em;
            color: #007bff;
            text-decoration: none;
        }
        .templates-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Toolbox Cyber - Testez vos modules</h1>
    <form action="/api/discover/" method="post">
        <h2>Découverte réseau</h2>
        <input type="text" name="network" placeholder="192.168.1.0/24" required>
        <button type="submit">Lancer</button>
    </form>

    <form action="/api/scan/" method="post">
        <h2>Scan de ports</h2>
        <input type="text" name="target" placeholder="IP cible" required>
        <input type="text" name="ports" placeholder="Ports (ex: 22,80,443)" required>
        <button type="submit">Lancer</button>
    </form>

    <form action="/api/enumerate/" method="post">
        <h2>Énumération des services</h2>
        <input type="text" name="target" placeholder="IP cible" required>
        <input type="text" name="ports" placeholder="Ports (ex: 22,80,443)" required>
        <button type="submit">Lancer</button>
    </form>

    <form action="/api/sniffer/start" method="post" id="sniffer-form">
        <h2>Capture de trafic réseau</h2>
        
        <div class="form-group">
            <label for="interface">Interface réseau :</label>
            <select name="interface" id="interface" class="form-control" required>
                <option value="">Chargement des interfaces...</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="count">Nombre de paquets à capturer :</label>
            <input type="number" name="count" id="count" value="100" min="1" max="10000" class="form-control" required>
        </div>
        
        <button type="submit" id="start-capture-btn" class="btn btn-primary">Lancer la capture</button>
    </form>

    <script>
        // Fonction pour charger la liste des interfaces réseau
        function loadInterfaces() {
            const selectElement = document.getElementById('interface');
            
            // Afficher un message de chargement
            selectElement.innerHTML = '<option value="">Chargement des interfaces...</option>';
            
            // Récupérer la liste des interfaces via l'API
            fetch('/api/sniffer/interfaces')
                .then(response => response.json())
                .then(data => {
                    // Vider la liste
                    selectElement.innerHTML = '';
                    
                    if (data.interfaces && data.interfaces.length > 0) {
                        // Ajouter chaque interface à la liste
                        data.interfaces.forEach(iface => {
                            const option = document.createElement('option');
                            option.value = iface.name;
                            option.textContent = `${iface.name} - ${iface.description || 'N/A'}`;
                            selectElement.appendChild(option);
                        });
                    } else {
                        // Aucune interface trouvée ou erreur
                        const option = document.createElement('option');
                        option.value = "";
                        option.textContent = "Aucune interface disponible";
                        selectElement.appendChild(option);
                    }
                })
                .catch(error => {
                    console.error('Erreur lors du chargement des interfaces:', error);
                    selectElement.innerHTML = '<option value="">Erreur de chargement</option>';
                });
        }
        
        // Charger les interfaces au chargement de la page
        document.addEventListener('DOMContentLoaded', loadInterfaces);
        
        // Gestion du formulaire de capture
        document.getElementById('sniffer-form').addEventListener('submit', function(event) {
            const startBtn = document.getElementById('start-capture-btn');
            startBtn.disabled = true;
            startBtn.textContent = 'Capture en cours...';
            
            // La soumission du formulaire se fait normalement (pas de preventDefault)
            // On laisse le formulaire se soumettre et rediriger vers la page des résultats
        });
    </script>

    <!-- Formulaire Hydra -->
    <form action="/api/hydra/attack" method="post" id="hydra-form">
        <h2>Attaque par force brute avec Hydra</h2>
        
        <div class="form-group">
            <label for="target">Cible (IP ou hôte):</label>
            <input type="text" name="target" id="target" class="form-control" placeholder="192.168.1.1" required>
        </div>
        
        <div class="form-group">
            <label for="service">Service:</label>
            <select name="service" id="service" class="form-control" required>
                <option value="">Chargement des services...</option>
            </select>
        </div>
        
        <!-- Options spécifiques aux formulaires HTTP (initialement cachées) -->
        <div id="http-options" style="display: none; border: 1px solid #ccc; padding: 15px; margin: 10px 0; background-color: #f9f9f9;">
            <h4>Options pour formulaire HTTP</h4>
            
            <div class="form-group">
                <label for="form_path">Chemin:</label>
                <input type="text" name="form_path" id="form_path" class="form-control" value="/" placeholder="/login.php">
            </div>
            
            <div class="form-group">
                <label for="form_data">Données du formulaire:</label>
                <input type="text" name="form_data" id="form_data" class="form-control" value="username=^USER^&password=^PASS^" placeholder="username=^USER^&password=^PASS^">
            </div>
            
            <div class="form-group">
                <label for="form_success">Message d'erreur:</label>
                <input type="text" name="form_success" id="form_success" class="form-control" value="F=incorrect" placeholder="F=Login failed">
                <small>Préfixez avec F= pour un message d'échec ou S= pour un message de succès</small>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group form-column">
                <label for="userlist">Liste d'utilisateurs:</label>
                <select name="userlist" id="userlist" class="form-control">
                    <option value="">Chargement des listes...</option>
                </select>
                
                <div class="wordlist-actions">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" id="toggle-custom-userlist"> Saisir une liste
                        </label>
                    </div>
                    
                    <button type="button" id="upload-userlist-btn" class="btn btn-sm btn-secondary">Importer un fichier</button>
                </div>
                
                <div id="custom-userlist-container" style="display: none;">
                    <label for="custom_userlist">Liste personnalisée (un nom par ligne):</label>
                    <textarea name="custom_userlist" id="custom_userlist" class="form-control" rows="5"></textarea>
                </div>
                
                <div id="upload-userlist-container" style="display: none; margin-top: 10px;">
                    <div class="upload-form">
                        <input type="file" id="userlist-file" accept=".txt,.lst,.dict,.wordlist">
                        <button type="button" id="submit-userlist-upload" class="btn btn-sm btn-secondary">Télécharger</button>
                    </div>
                    <div id="userlist-upload-status"></div>
                </div>
            </div>
            
            <div class="form-group form-column">
                <label for="passlist">Liste de mots de passe:</label>
                <select name="passlist" id="passlist" class="form-control">
                    <option value="">Chargement des listes...</option>
                </select>
                
                <div class="wordlist-actions">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" id="toggle-custom-passlist"> Saisir une liste
                        </label>
                    </div>
                    
                    <button type="button" id="upload-passlist-btn" class="btn btn-sm btn-secondary">Importer un fichier</button>
                </div>
                
                <div id="custom-passlist-container" style="display: none;">
                    <label for="custom_passlist">Liste personnalisée (un mot de passe par ligne):</label>
                    <textarea name="custom_passlist" id="custom_passlist" class="form-control" rows="5"></textarea>
                </div>
                
                <div id="upload-passlist-container" style="display: none; margin-top: 10px;">
                    <div class="upload-form">
                        <input type="file" id="passlist-file" accept=".txt,.lst,.dict,.wordlist">
                        <button type="button" id="submit-passlist-upload" class="btn btn-sm btn-secondary">Télécharger</button>
                    </div>
                    <div id="passlist-upload-status"></div>
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="tasks">Tâches parallèles:</label>
            <input type="number" name="tasks" id="tasks" min="1" max="64" value="16" class="form-control">
            <small>Nombre de connexions parallèles (1-64)</small>
        </div>
        
        <div class="checkbox">
            <label>
                <input type="checkbox" name="verbose" id="verbose"> Mode verbeux
            </label>
        </div>
        
        <button type="submit" id="start-hydra-btn" class="btn btn-primary">Lancer l'attaque</button>
    </form>

    <style>
    /* Styles spécifiques au formulaire Hydra */
    .form-row {
        display: flex;
        gap: 15px;
        margin-bottom: 15px;
    }

    .form-column {
        flex: 1;
    }

    #hydra-form {
        background-color: #f5f5f5;
        padding: 20px;
        border-radius: 5px;
        margin-bottom: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    #hydra-form h2 {
        color: #333;
        margin-top: 0;
        border-bottom: 2px solid #4CAF50;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    #hydra-form h4 {
        margin-top: 0;
        color: #555;
    }

    .wordlist-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 10px 0;
    }

    .checkbox {
        margin: 10px 0;
    }

    textarea.form-control {
        resize: vertical;
    }

    #start-hydra-btn {
        margin-top: 15px;
    }

    .upload-form {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
        border-color: #6c757d;
    }

    .btn-secondary:hover {
        background-color: #5a6268;
        border-color: #545b62;
    }

    #userlist-upload-status,
    #passlist-upload-status {
        margin-top: 5px;
        font-size: 0.9em;
    }
    </style>

    <script>
    // Fonction pour charger les services supportés
    function loadServices() {
        const selectElement = document.getElementById('service');
        
        // Afficher un message de chargement
        selectElement.innerHTML = '<option value="">Chargement des services...</option>';
        
        // Récupérer la liste des services via l'API
        fetch('/api/hydra/services', {
            headers: { 'Accept': 'application/json' }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Réponse réseau non valide');
            }
            return response.json();
        })
        .then(data => {
            // Vider la liste
            selectElement.innerHTML = '';
            
            // Option par défaut
            const defaultOption = document.createElement('option');
            defaultOption.value = "";
            defaultOption.textContent = "Sélectionnez un service";
            selectElement.appendChild(defaultOption);
            
            if (data.services && data.services.length > 0) {
                // Ajouter chaque service à la liste
                data.services.forEach(service => {
                    const option = document.createElement('option');
                    option.value = service.name;
                    option.textContent = `${service.name} (${service.description} - port ${service.port})`;
                    selectElement.appendChild(option);
                });
            } else {
                // Aucun service trouvé ou erreur
                const option = document.createElement('option');
                option.value = "";
                option.textContent = "Aucun service disponible";
                selectElement.appendChild(option);
            }
        })
        .catch(error => {
            console.error('Erreur lors du chargement des services:', error);
            selectElement.innerHTML = '<option value="">Erreur de chargement</option>';
        });
    }

    // Fonction pour charger les wordlists
    function loadWordlists() {
        const userSelect = document.getElementById('userlist');
        const passSelect = document.getElementById('passlist');
        
        // Afficher un message de chargement
        userSelect.innerHTML = '<option value="">Chargement des listes...</option>';
        passSelect.innerHTML = '<option value="">Chargement des listes...</option>';
        
        // Récupérer la liste des wordlists via l'API
        fetch('/api/hydra/wordlists', {
            headers: { 'Accept': 'application/json' }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Réponse réseau non valide');
            }
            return response.json();
        })
        .then(data => {
            // Vider les listes
            userSelect.innerHTML = '';
            passSelect.innerHTML = '';
            
            // Option par défaut
            userSelect.innerHTML = '<option value="">Sélectionnez une liste d\'utilisateurs</option>';
            passSelect.innerHTML = '<option value="">Sélectionnez une liste de mots de passe</option>';
            
            // Ajouter les listes d'utilisateurs
            if (data.user_lists && data.user_lists.length > 0) {
                data.user_lists.forEach(list => {
                    const option = document.createElement('option');
                    option.value = list.path;
                    option.textContent = list.name;
                    userSelect.appendChild(option);
                });
            }
            
            // Ajouter les listes de mots de passe
            if (data.pass_lists && data.pass_lists.length > 0) {
                data.pass_lists.forEach(list => {
                    const option = document.createElement('option');
                    option.value = list.path;
                    option.textContent = list.name;
                    passSelect.appendChild(option);
                });
            }
        })
        .catch(error => {
            console.error('Erreur lors du chargement des wordlists:', error);
            userSelect.innerHTML = '<option value="">Erreur de chargement</option>';
            passSelect.innerHTML = '<option value="">Erreur de chargement</option>';
        });
    }

    // Fonction pour télécharger une wordlist
    function uploadWordlist(file, listType) {
        const formData = new FormData();
        formData.append('file', file);
        formData.append('list_type', listType);
        
        const statusElement = document.getElementById(`${listType}-upload-status`);
        statusElement.innerHTML = '<span style="color: blue;">Téléchargement en cours...</span>';
        
        fetch('/api/hydra/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Erreur lors du téléchargement');
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                statusElement.innerHTML = `<span style="color: green;">✓ ${data.message}</span>`;
                
                // Recharger les wordlists pour voir le nouveau fichier
                loadWordlists();
                
                // Sélectionner automatiquement le fichier téléchargé après un délai
                setTimeout(() => {
                    const selectElement = document.getElementById(listType === 'userlist' ? 'userlist' : 'passlist');
                    for (let i = 0; i < selectElement.options.length; i++) {
                        if (selectElement.options[i].textContent === data.file_name) {
                            selectElement.selectedIndex = i;
                            break;
                        }
                    }
                }, 1000); // Attendre un peu que les listes soient rechargées
            } else {
                statusElement.innerHTML = `<span style="color: red;">✗ ${data.error || 'Erreur inconnue'}</span>`;
            }
        })
        .catch(error => {
            console.error('Erreur lors du téléchargement:', error);
            statusElement.innerHTML = `<span style="color: red;">✗ Erreur de téléchargement: ${error.message}</span>`;
        });
    }

    // Gérer l'affichage des options HTTP en fonction du service sélectionné
    document.getElementById('service').addEventListener('change', function() {
        const httpOptions = document.getElementById('http-options');
        if (this.value && this.value.includes('http')) {
            httpOptions.style.display = 'block';
        } else {
            httpOptions.style.display = 'none';
        }
    });

    // Gérer l'affichage des champs de listes personnalisées
    document.getElementById('toggle-custom-userlist').addEventListener('change', function() {
        document.getElementById('custom-userlist-container').style.display = this.checked ? 'block' : 'none';
        document.getElementById('userlist').disabled = this.checked;
        // Cacher l'upload si la saisie manuelle est activée
        if (this.checked) {
            document.getElementById('upload-userlist-container').style.display = 'none';
        }
    });

    document.getElementById('toggle-custom-passlist').addEventListener('change', function() {
        document.getElementById('custom-passlist-container').style.display = this.checked ? 'block' : 'none';
        document.getElementById('passlist').disabled = this.checked;
        // Cacher l'upload si la saisie manuelle est activée
        if (this.checked) {
            document.getElementById('upload-passlist-container').style.display = 'none';
        }
    });

    // Gérer l'affichage des formulaires d'upload
    document.getElementById('upload-userlist-btn').addEventListener('click', function() {
        const uploadContainer = document.getElementById('upload-userlist-container');
        uploadContainer.style.display = uploadContainer.style.display === 'none' ? 'block' : 'none';
        // Désactiver la saisie manuelle si l'upload est activé
        if (uploadContainer.style.display === 'block') {
            document.getElementById('toggle-custom-userlist').checked = false;
            document.getElementById('custom-userlist-container').style.display = 'none';
        }
    });

    document.getElementById('upload-passlist-btn').addEventListener('click', function() {
        const uploadContainer = document.getElementById('upload-passlist-container');
        uploadContainer.style.display = uploadContainer.style.display === 'none' ? 'block' : 'none';
        // Désactiver la saisie manuelle si l'upload est activé
        if (uploadContainer.style.display === 'block') {
            document.getElementById('toggle-custom-passlist').checked = false;
            document.getElementById('custom-passlist-container').style.display = 'none';
        }
    });

    // Gérer les téléchargements de fichiers
    document.getElementById('submit-userlist-upload').addEventListener('click', function() {
        const fileInput = document.getElementById('userlist-file');
        if (fileInput.files.length > 0) {
            uploadWordlist(fileInput.files[0], 'userlist');
        } else {
            document.getElementById('userlist-upload-status').innerHTML = '<span style="color: red;">✗ Veuillez sélectionner un fichier</span>';
        }
    });

    document.getElementById('submit-passlist-upload').addEventListener('click', function() {
        const fileInput = document.getElementById('passlist-file');
        if (fileInput.files.length > 0) {
            uploadWordlist(fileInput.files[0], 'passlist');
        } else {
            document.getElementById('passlist-upload-status').innerHTML = '<span style="color: red;">✗ Veuillez sélectionner un fichier</span>';
        }
    });

    // Gérer la soumission du formulaire
    document.getElementById('hydra-form').addEventListener('submit', function(event) {
        const startBtn = document.getElementById('start-hydra-btn');
        startBtn.disabled = true;
        startBtn.innerHTML = 'Attaque en cours...';
        
        // Vérifier que soit une liste prédéfinie, soit une liste personnalisée est fournie
        const customUserList = document.getElementById('toggle-custom-userlist').checked;
        const customPassList = document.getElementById('toggle-custom-passlist').checked;
        
        if (!customUserList && !document.getElementById('userlist').value) {
            event.preventDefault();
            alert('Veuillez sélectionner une liste d\'utilisateurs ou fournir une liste personnalisée.');
            startBtn.disabled = false;
            startBtn.innerHTML = 'Lancer l\'attaque';
            return false;
        }
        
        if (!customPassList && !document.getElementById('passlist').value) {
            event.preventDefault();
            alert('Veuillez sélectionner une liste de mots de passe ou fournir une liste personnalisée.');
            startBtn.disabled = false;
            startBtn.innerHTML = 'Lancer l\'attaque';
            return false;
        }
        
        // La soumission continue normalement si tout est valide
    });

    // Charger les données au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Chargement des données...");
        loadServices();
        loadWordlists();
    });
    </script>
</body>
</html>
